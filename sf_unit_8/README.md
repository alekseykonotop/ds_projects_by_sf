# Проект Ford vs Ferrary
## Описание:
Вы работаете в компании, которая занимается продажей автомобилей с пробегом в Москве. В этом модуле вам нужно построить модель классификации изображений.  
Классифицировать мы будем автомобили по их фотографиям.  

### Чем мы будем заниматься?

- Построим свой классификатор изображений.
- Применим различные методы предобработки изображений
- Задействуем сразу несколько методов обучения (finetuning, transfer learning и так далее)
- Научимся использовать предобученные модели для решения своих задач
- Найдем и используем в работе State of the Art (SOTA)-модели

## Какой кейс решаем?
Вы работаете в компании, которая занимается продажей автомобилей с пробегом в Москве.
Основная задача компании и её менеджеров — максимально быстро находить выгодные предложения (проще говоря, купить ниже рынка, а продать дороже рынка).
В прошлом проекте вы построили модель которая предсказывает стоимость автомобиля по его характеристикам.
Теперь перед вам предстоит построить модель классификации изображений автомобилей по их фотографиям.  

### Условия соревнования:  
[Ссылка на закрытое соревнование](https://www.kaggle.com/c/sf-dl-car-classification)  
- Данное соревнование является бессрочным и доступно для всех потоков.
- Срок выполнения соревнования устанавливаеться индивидуально в каждом потоке.
- Тестовая выборка представлена в ЛидерБорде целиком.
- Лучшие и победные решения буду проверяться на воспроизводимость и "адекватность" (чтоб не было подгонки под тестовую выборку).

**Метрика качества**  
Результаты оцениваются по метрике accuracy — доля правильных ответов модели

### Краткая информация о данных
- train.csv - метки к тренировочной базе фотографий авто
- train.zip - тренировочная база фотографий авто (10 типов)
- test.zip - тестовая база фотографий авто
- sample-submission.csv - пример правильного формата submission file  

## Этапы работы над проектом  
- провел 20+ тестов и сформировал предварительные гиперпараметры модели перед тонкой настройкой  
- протестировал различные архитектуры головы (Custom Head)  
- протестировал несколько методов аугментации данных  
    - встроенный в keras класс ImageDataGenerator  
    - библиотека для аугментации данных albumentations  
- Собрал из внешних источников 4468 изображений авто из представленных классов для:  
    - устранения не сбалансированности классов  
    - повышения качества модели за счет обучения на большем кол-ве данных
- В ручном режиме отфильтровал из тренировочных данных изображения, не соответствующие представленным классам
- протестировал несколько основных callback-функций с разными параметрами:  
    - ModelCheckpoint  
    - EarlyStopping  
    - EarlyStopping  
    - ReduceLROnPlateau  
- обучение, протестировал разные вариации LR и sheduler  
- применил тонкую настройку модели (fine-tuning):
    - Этап 1: заморозил базовую модель полностью
    - Этап 2: заморозил базовую модель на половину и снизил LR и BATCH_SIZE
    - Этап 3: разморозил базовую модель полностью и снизил LR и BATCH_SIZE
    - Этап 4: Увеличил размер входных данных и понизил уровень аугментации данных, а так же BATCH_SIZE
- сделал сабмишн на чистых тестовых данных
- сделал сабмишн на тестовых данных с использованием TTA

## Результат:  
- score на kaggle = 0.97138 (73 место из 264)  
- [ноутбук на kaggle](https://www.kaggle.com/alekseykonotop/final-notebook-ar-lassification-ipynb)  
- score без TTA - 0.97138  
- score c TTA - 0.92344 - значительно хуже